<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="ThemeBucket">
  <link rel="shortcut icon" href="#" type="image/png">

  <title>新建病历</title>

    <!--ios7-->
    <link rel="stylesheet" type="text/css" href="/js/ios-switch/switchery.css" />

    <!--pickers css-->
    <!--<link rel="stylesheet" type="text/css" href="/js/bootstrap-datepicker/css/datepicker-custom.css" />-->
    <!--<link rel="stylesheet" type="text/css" href="/js/bootstrap-timepicker/css/timepicker.css" />-->
    <!--<link rel="stylesheet" type="text/css" href="/js/bootstrap-colorpicker/css/colorpicker.css" />-->
    <!--<link rel="stylesheet" type="text/css" href="/js/bootstrap-daterangepicker/daterangepicker-bs3.css" />-->
    <!--<link rel="stylesheet" type="text/css" href="/js/bootstrap-datetimepicker/css/datetimepicker-custom.css" />-->

    <link rel="stylesheet" type="text/css" media="screen" href="/css/bootstrap.min.css" >
    <link rel="stylesheet" type="text/css" media="screen" href="/css/bootstrap-datetimepicker.min.css">

    <!--icheck-->
    <link href="/js/iCheck/skins/minimal/minimal.css" rel="stylesheet" />
    <link href="/js/iCheck/skins/minimal/red.css" rel="stylesheet" />
    <link href="/js/iCheck/skins/minimal/green.css" rel="stylesheet" />
    <link href="/js/iCheck/skins/minimal/blue.css" rel="stylesheet" />
    <link href="/js/iCheck/skins/minimal/yellow.css" rel="stylesheet" />
    <link href="/js/iCheck/skins/minimal/purple.css" rel="stylesheet" />

    <link href="/js/iCheck/skins/square/square.css" rel="stylesheet" />
    <link href="/js/iCheck/skins/square/red.css" rel="stylesheet" />
    <link href="/js/iCheck/skins/square/green.css" rel="stylesheet" />
    <link href="/js/iCheck/skins/square/blue.css" rel="stylesheet" />
    <link href="/js/iCheck/skins/square/yellow.css" rel="stylesheet" />
    <link href="/js/iCheck/skins/square/purple.css" rel="stylesheet" />

    <link href="/js/iCheck/skins/flat/grey.css" rel="stylesheet" />
    <link href="/js/iCheck/skins/flat/red.css" rel="stylesheet" />
    <link href="/js/iCheck/skins/flat/green.css" rel="stylesheet" />
    <link href="/js/iCheck/skins/flat/blue.css" rel="stylesheet" />
    <link href="/js/iCheck/skins/flat/yellow.css" rel="stylesheet" />
    <link href="/js/iCheck/skins/flat/purple.css" rel="stylesheet" />

    <!--multi-select-->
    <link rel="stylesheet" type="text/css" href="/js/jquery-multi-select/css/multi-select.css" />

    <!--file upload-->
    <link rel="stylesheet" type="text/css" href="/css/bootstrap-fileupload.min.css" />

    <!--tags input-->
    <link rel="stylesheet" type="text/css" href="/js/jquery-tags-input/jquery.tagsinput.css" />



  <link href="/css/style.css" rel="stylesheet" />
  <link href="/css/style-responsive.css" rel="stylesheet" />

  <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
    <script src="/js/html5shiv.js"></script>
    <script src="/js/respond.min.js"></script>
    <![endif]-->
</head>

<body class="sticky-header">

<section>
    <!-- left side start-->
    <div class="left-side sticky-left-side">

        <!--logo and iconic logo start-->
        <div class="logo">
            <a href="/index"><img src="/images/logo.png" alt="" /></a>
        </div>

        <div class="logo-icon text-center">
            <a href="/index"><img src="/images/logo_icon.png" alt="" /></a>
        </div>
        <!--logo and iconic logo end-->


        <div class="left-side-inner">

            <!--sidebar nav start-->
            <ul class="nav nav-pills nav-stacked custom-nav">
                <li class="active"><a href="/home"><i class="fa fa-home"></i> <span>首页</span></a></li>
                <li class="menu-list"><a href=""><i class="fa fa-laptop"></i> <span>病人管理</span></a>
                    <ul class="sub-menu-list">
                        <li><a href="/patient/today"> 今日病人</a></li>
                        <li><a href="/patient/listAll"> 全部病人</a></li>
                    </ul>
                </li>
                <li><a href="/patient/add"><i class="fa fa-bullhorn"></i> <span>新建病人</span></a></li>
                <li><a href="/disease/list"><i class="fa fa-bar-chart-o"></i> <span>疾病管理</span></a></li>
                <li><a href="/stock/list"><i class="fa fa-th-list"></i> <span>药品库存</span></a></li>
                <li><a href="/record/list"><i class="fa fa-book"></i> <span>收支记录</span></a></li>
            </ul>
            <!--sidebar nav end-->

        </div>
    </div>
    <!-- left side end-->

    <!-- main content start-->
    <div class="main-content" >

        <!-- header section start-->
        <div class="header-section">

            <!--toggle button start-->
            <a class="toggle-btn"><i class="fa fa-bars"></i></a>
            <!--toggle button end-->

            <!--search start-->
            <form class="searchform" action="home" method="post">
                <input type="text" class="form-control" name="keyword" placeholder="搜索" />
            </form>
            <!--search end-->

            <!--notification menu start -->
            <div class="menu-right">
                <ul class="notification-menu">
                    <li>
                        <a href="#" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                            <img src="/images/photos/user-avatar.png" alt="" />
                            王主任
                            <span class="caret"></span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-usermenu pull-right">
                            <li><a href="profile"><i class="fa fa-user"></i>  人物简介</a></li>
                            <li><a href="#"><i class="fa fa-cog"></i>  个人设置</a></li>
                            <li onclick="deleteToken()"><a href="login"><i class="fa fa-sign-out"></i> 注销</a></li>
                        </ul>
                    </li>

                </ul>
            </div>
            <!--notification menu end -->

        </div>
        <!-- header section end-->

        <!-- page heading start-->
        <div class="page-heading">
            <h3>
                新建病历
            </h3>
        </div>
        <!-- page heading end-->

        <!--body wrapper start-->
        <div class="wrapper">

            <div class="row">
                <div class="col-md-12">
                    <section class="panel">
                        <div class="panel-body">
                            <form id="addCaseHistoryForm" action="#" class="form-horizontal " enctype="multipart/form-data" method="post">
                                <input id="in_patientID" name="patientId" th:value="${patientId}" type="hidden" />
                                <div class="form-group">
                                    <label class="control-label col-md-3">病名</label>
                                    <div class="col-md-9">
                                        <select name="disease" class="multi-select" multiple="" id="my_multi_select3">
                                            <option value="AF">病1</option>
                                            <option value="AL">病2</option>
                                            <option value="DZ">病3</option>
                                            <option value="AS">病4</option>
                                            <option value="AD">病5</option>
                                            <option value="AO">病6</option>
                                            <option value="AI">病7</option>
                                            <option value="AQ">病8</option>
                                            <option value="AR">病9</option>
                                            <option value="AM">病10</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="control-label col-md-3">发病时间</label>

                                    <!--<div class="col-md-4 col-xs-11">-->
                                        <!--<input class="form-control form-control-inline input-medium default-date-picker" date-date-format="yyyy-mm-dd" name="onset" size="16" type="text"  />-->
                                        <!--<span class="help-block">选择日期</span>-->
                                    <!--</div>-->
                                    <div class="input-group date form_datetime col-md-5" data-date="2017-11-11T05:25:07Z" data-date-format="yyyy-mm-dd hh:ii" data-link-field="in_onset">
                                        <input class="form-control" size="16" type="text" value="" readonly>
                                        <span class="input-group-addon"><span class="glyphicon glyphicon-remove"></span></span>
                                        <span class="input-group-addon"><span class="glyphicon glyphicon-th"></span></span>

                                    </div>
                                    <input type="hidden" id="in_onset" name="onset" value="" /><br/>
                                </div>

                                <!--<div class="form-group">-->
                                    <!--<label class="control-label col-md-3">症状</label>-->
                                    <!--<div class="col-md-6 col-sm-6">-->
                                        <!--<textarea form="addCaseHistoryForm" name="description" rows="5" cols="60" class="form-control"></textarea>-->
                                    <!--</div>-->
                                <!--</div>-->

                                <div class="form-group">
                                    <label class="control-label col-md-3">症状图</label>
                                    <div class="col-md-9">
                                        <div class="fileupload fileupload-new" data-provides="fileupload">
                                            <div class="fileupload-new thumbnail" style="width: 200px; height: 150px;">
                                                <img src="http://www.placehold.it/200x150/EFEFEF/AAAAAA&amp;text=no+image" alt="" />
                                            </div>
                                            <div class="fileupload-preview fileupload-exists thumbnail" style="max-width: 200px; max-height: 150px; line-height: 20px;"></div>
                                            <div>
                                                   <span class="btn btn-default btn-file">
                                                   <span class="fileupload-new"><i class="fa fa-paper-clip"></i> 选择图片</span>
                                                   <span class="fileupload-exists"><i class="fa fa-undo"></i> 更改</span>
                                                   <input type="file" class="default" id="in_files" name="files" multiple="multiple" />
                                                   </span>
                                                <a href="#" class="btn btn-danger fileupload-exists" data-dismiss="fileupload"><i class="fa fa-trash"></i> 取消</a>
                                            </div>
                                        </div>
                                        <br/>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <!--<label class="control-label col-md-3">开药</label>-->
                                    <!--<a class="btn btn-primary" data-toggle="modal" href="#myModal2">-->
                                                    <!--添加药品-->
                                    <!--</a>-->
                                    <!-- Modal -->
                                    <!--<div class="modal fade" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" >-->
                                        <!--<div class="modal-dialog">-->
                                            <!--<div class="modal-content">-->
                                                <!--<div class="modal-header">-->
                                                                <!--<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>-->
                                                                <!--<h4 class="modal-title">开药</h4>-->
                                                            <!--</div>-->
                                                <!--<div class="modal-body">-->
                                                                <!--<form action="#" class="form-horizontal ">-->
                                                                    <!--<div class="form-group">-->
                                                                        <!--<label class="control-label col-md-4"> 药名</label>-->
                                                                        <!--<div class="col-md-6">-->
                                                                            <!--<select class="form-control m-bot15 multi-select" multiple="">-->
                                                                                <!--<option>药 1</option>-->
                                                                                <!--<option>药 2</option>-->
                                                                                <!--<option>药 3</option>-->
                                                                            <!--</select>-->
                                                                        <!--</div>-->

                                                                    <!--</div>-->
                                                                    <!--<div class="form-group">-->
                                                                        <!--<label class="control-label col-md-4"> 数量</label>-->
                                                                        <!--<div class="col-md-2">-->
                                                                            <!--<input type="text" placeholder="" class="form-control">-->
                                                                        <!--</div>-->
                                                                        <!--<label class="col-md-2"> 单位</label>-->
                                                                    <!--</div>-->
                                                                    <!--<div class="form-group">-->
                                                                        <!--<label class="control-label col-md-4"> 用药时长</label>-->
                                                                        <!--<div class="col-md-2">-->
                                                                            <!--<input type="text" placeholder="" class="form-control">-->
                                                                        <!--</div>-->
                                                                        <!--<label class="control-label col-md-1"> 天</label>-->
                                                                    <!--</div>-->
                                                                    <!--<div class="form-group">-->
                                                                        <!--<label class="control-label col-md-4"> 用药间隔</label>-->
                                                                        <!--<div class="col-md-6">-->
                                                                            <!--<select class="form-control m-bot15">-->
                                                                                <!--<option>一天一次</option>-->
                                                                                <!--<option>一天两次</option>-->
                                                                                <!--<option>一天三次</option>-->
                                                                            <!--</select>-->
                                                                        <!--</div>-->

                                                                    <!--</div>-->
                                                                <!--</form>-->
                                                            <!--</div>-->
                                                <!--<div class="modal-footer">-->
                                                    <!--<button data-dismiss="modal" class="btn btn-primary" type="button">保存</button>-->
                                                    <!--<button data-dismiss="modal" class="btn btn-primary" type="button">关闭</button>-->
                                                <!--</div>-->
                                            <!--</div>-->
                                        <!--</div>-->
                                    <!--</div>-->

                                    <!-- modal -->
                                    <!--******************************-->


                                    <!--******************************-->
                                    <div class="wrapper">
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <section class="panel">
                                                    <header class="panel-heading">
                                                        开药明细
                                                    </header>
                                                    <div class="panel-body">
                                                        <div class="adv-table editable-table ">
                                                            <div class="clearfix">
                                                                <div class="btn-group">
                                                                    <button id="editable-sample_new" class="btn btn-primary">
                                                                        添加记录 <i class="fa fa-plus"></i>
                                                                    </button>
                                                                </div>
                                                            </div>
                                                            <div class="space15"></div>
                                                            <p id="tablePage" hidden="hidden">/record</p>
                                                            <table class="table table-striped table-hover table-bordered" id="editable-sample">
                                                                <thead>
                                                                <tr>
                                                                    <th>药名</th>
                                                                    <th>总量（粒）</th>
                                                                    <th>用药时长（小时）</th>
                                                                    <th>间隔（小时）</th>
                                                                    <th>编辑</th>
                                                                    <th>删除</th>
                                                                </tr>
                                                                </thead>
                                                                <tbody>
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                </section>
                                            </div>
                                        </div>
                                    </div>

                                        <div class="form-group">
                                            <div class="control-label col-md-4">
                                                <button class="btn btn-primary" type="button" onclick="submitAll()">提交</button>
                                            </div>
                                        </div>
                                </div>

                            </form>


                        </div>
                    </section>
                </div>
            </div>


        </div>
        <!--body wrapper end-->

        <!--footer section start-->
        <footer>
            2017 &copy; Medical History Supervisor
        </footer>
        <!--footer section end-->


    </div>
    <!-- main content end-->
</section>

<!-- Placed js at the end of the document so the pages load faster -->
<script src="/js/jquery-1.10.2.min.js"></script>
<script src="/js/jquery-ui-1.9.2.custom.min.js"></script>
<script src="/js/jquery-migrate-1.2.1.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/modernizr.min.js"></script>
<script src="/js/jquery.nicescroll.js"></script>

<!--ios7-->
<script src="/js/ios-switch/switchery.js" ></script>
<script src="/js/ios-switch/ios-init.js" ></script>

<!--icheck -->
<script src="/js/iCheck/jquery.icheck.js"></script>
<script src="/js/icheck-init.js"></script>
<!--multi-select-->
<script type="text/javascript" src="/js/jquery-multi-select/js/jquery.multi-select.js"></script>
<script type="text/javascript" src="/js/jquery-multi-select/js/jquery.quicksearch.js"></script>
<script src="/js/multi-select-init.js"></script>
<!--spinner-->
<script type="text/javascript" src="/js/fuelux/js/spinner.min.js"></script>
<script src="/js/spinner-init.js"></script>
<!--file upload-->
<script type="text/javascript" src="/js/bootstrap-fileupload.min.js"></script>
<!--tags input-->
<script src="/js/jquery-tags-input/jquery.tagsinput.js"></script>
<script src="/js/tagsinput-init.js"></script>

<!--pickers plugins-->
<!--<script type="text/javascript" src="/js/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>-->
<!--<script type="text/javascript" src="/js/bootstrap-datetimepicker/js/bootstrap-datetimepicker.js"></script>-->
<!--<script type="text/javascript" src="/js/bootstrap-daterangepicker/moment.min.js"></script>-->
<!--<script type="text/javascript" src="/js/bootstrap-daterangepicker/daterangepicker.js"></script>-->
<!--<script type="text/javascript" src="/js/bootstrap-colorpicker/js/bootstrap-colorpicker.js"></script>-->
<!--<script type="text/javascript" src="/js/bootstrap-timepicker/js/bootstrap-timepicker.js"></script>-->
<script type="text/javascript" src="/js/bootstrap-datetimepicker.js" charset="UTF-8"></script>
<script type="text/javascript" src="/js/locales/bootstrap-datetimepicker.fr.js" charset="UTF-8"></script>
<script type="text/javascript">
    $('.form_datetime').datetimepicker({
        //language:  'fr',
        weekStart: 1,
        todayBtn:  1,
        autoclose: 1,
        todayHighlight: 1,
        startView: 2,
        forceParse: 0,
        showMeridian: 1
    });
</script>
<script>
    function submitAll() {
        var form = new FormData(document.getElementById("addCaseHistoryForm"));
        $.ajax({
            url:"/case-history/add",
            type:"post",
            data:form,
            processData:false,
            contentType:false,
            success:function(data){
                alert("upload case history completed, start uploading medicine record...");
                submitMedRecord();
            },
            error:function(e){
                alert("oops...nothing happened");
            }
        });
    }
    function submitMedRecord()
    {
        $("#editable-sample tr").each(function(j){
            var myArr=new Array();
            $(this).find("td").each(function(i){
                myArr[i]=$(this).text();
            });
            if(myArr.length>3)
            {
                $.ajax({
                    url:"/medicine/add",
                    type:"post",
                    data:{
                        "medicine":myArr[0],
                        "totalDose":myArr[1],
                        "duration":myArr[2],
                        "timeInterval":myArr[3],
                        "patientId": $("#in_patientID").val()
                    },
                    dataType:"text",
                    timeOut:50000,
                    success:function(data){
                        alert("upload "+j+"th medicine record completed");
                        var tab=document.getElementById("editable-sample");
                        var rows=tab.rows.length;
                        if((j+1)==rows)
                        {
                            window.location.href="/patient/home/"+$("#in_patientID").val();
                        }
                    },
                    error:function(XMLHttpRequest, textStatus, errorThrown){
                        alert(XMLHttpRequest.status);
                        alert(XMLHttpRequest.readyState);
                    }
                });
            }
        });
    }
</script>

<!--pickers initialization-->
<script src="/js/pickers-init.js"></script>
<!--bootstrap input mask-->
<script type="text/javascript" src="/js/bootstrap-inputmask/bootstrap-inputmask.min.js"></script>


<!--common scripts for all pages-->
<script src="/js/scripts.js"></script>
<!--data table-->
<script type="text/javascript" src="/js/data-tables/jquery.dataTables.js"></script>
<script type="text/javascript" src="/js/data-tables/DT_bootstrap.js"></script>
<script src="/js/editable-table.js"></script>
<script>
    jQuery(document).ready(function() {
        EditableTable.init();
    });
</script>
</body>
</html>
